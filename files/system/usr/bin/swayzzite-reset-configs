#!/usr/bin/env bash
# Reset user configs to Swayzzite stock defaults
# This script backs up existing configs and restores the system defaults

set -oue pipefail

# Color output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

info() {
    echo -e "${GREEN}[INFO]${NC} $1"
}

warn() {
    echo -e "${YELLOW}[WARN]${NC} $1"
}

error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# Check if running as user (not root)
if [ "$EUID" -eq 0 ]; then
    error "This script should be run as a regular user, not as root."
    exit 1
fi

CONFIG_DIR="$HOME/.config"
BACKUP_DIR="$HOME/.config/backup-$(date +%Y%m%d-%H%M%S)"
STOCK_CONFIG_DIR="/etc/skel/.config"

# Config directories/files to reset
CONFIGS=(
    "sway"
    "waybar"
    "tofi"
    "hypr"
    "foot"
    "fish"
    "swaync"
)

info "Swayzzite Configuration Reset"
echo ""
warn "This will reset your custom configs to Swayzzite defaults."
warn "A backup will be created at: $BACKUP_DIR"
echo ""
read -p "$(echo -e ${YELLOW}Continue? [y/N]: ${NC})" -n 1 -r
echo ""
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    info "Aborted."
    exit 0
fi

# Create backup directory
info "Creating backup directory..."
mkdir -p "$BACKUP_DIR"

# Backup and reset each config
for config in "${CONFIGS[@]}"; do
    USER_CONFIG="$CONFIG_DIR/$config"
    STOCK_CONFIG="$STOCK_CONFIG_DIR/$config"

    if [ -d "$USER_CONFIG" ]; then
        info "Backing up $config..."
        cp -r "$USER_CONFIG" "$BACKUP_DIR/"
    fi

    if [ -d "$STOCK_CONFIG" ]; then
        info "Restoring stock $config..."
        rm -rf "$USER_CONFIG"
        cp -r "$STOCK_CONFIG" "$USER_CONFIG"
    else
        warn "Stock config for $config not found at $STOCK_CONFIG"
    fi
done

# Handle GTK configs separately (they're files, not directories)
if [ -f "$CONFIG_DIR/gtk-3.0/settings.ini" ]; then
    mkdir -p "$BACKUP_DIR/gtk-3.0"
    cp "$CONFIG_DIR/gtk-3.0/settings.ini" "$BACKUP_DIR/gtk-3.0/"
fi

if [ -f "$CONFIG_DIR/gtk-4.0/settings.ini" ]; then
    mkdir -p "$BACKUP_DIR/gtk-4.0"
    cp "$CONFIG_DIR/gtk-4.0/settings.ini" "$BACKUP_DIR/gtk-4.0/"
fi

info "Restoring stock GTK configs..."
if [ -d "$STOCK_CONFIG_DIR/gtk-3.0" ]; then
    mkdir -p "$CONFIG_DIR/gtk-3.0"
    cp "$STOCK_CONFIG_DIR/gtk-3.0/settings.ini" "$CONFIG_DIR/gtk-3.0/"
fi

if [ -d "$STOCK_CONFIG_DIR/gtk-4.0" ]; then
    mkdir -p "$CONFIG_DIR/gtk-4.0"
    cp "$STOCK_CONFIG_DIR/gtk-4.0/settings.ini" "$CONFIG_DIR/gtk-4.0/"
fi

echo ""
info "Configuration reset completed!"
info "Backup saved to: $BACKUP_DIR"
echo ""
info "To restore your backup manually:"
info "  cp -r $BACKUP_DIR/* ~/.config/"
echo ""
info "To apply the changes, reload Sway:"
info "  Press Super+Shift+c to reload"
echo ""
